---
title: js闭包
date: 2018-11-22 22:07:29
tags: ['js', '闭包']
summary:
---
### 1.变量作用域
要理解闭包，先要理解js的变量作用域：全局变量，局部变量
函数内部可以直接读取全局变量，但在函数外部无法读取函数内部的局部变量
函数内部申明变量的时候，需使用var等，否则申明的是全局变量

### 2.如何从外部读取函数内部的局部变量
```javascript
function F1(){
    var n = 999;
    function F2(){
        console.log(n); // 999
    }
    return F2;
}
var F1Tem = F1();
F1Tem();
```
函数F2读取函数F1的局部变量，只要把F2作为返回值，就能在F1外读取它的局部变量

### 3.闭包的概念
闭包就是能够读取其他函数内部变量的函数，js中只有函数内部的子函数才能读取局部变量，所以闭包可以理解为“定义在一个函数内部的函数”。在本质上，闭包是将函数内部和函数外部连接起来的桥梁。
F2函数就是闭包函数。

### 4.闭包的特点
* 函数嵌套函数
* 内部函数可以访问外部函数的变量
* 参数和变量不会被回收

### 5.闭包的用途
一个是可以读取函数内部的变量，另一个是让这些变量的值始终保持在内存中，不会在F1调用后自动清除

### 6.闭包的缺陷
常驻内存会增大内存的使用量，并且使用不当很容易造成内存泄露
如果不是因为特殊原因需要闭包，在没有必要的情况下，在其他函数中创建函数是不明智的，因为闭包对脚本性能具有负面影响，包括处理速度和内存的消耗

### 7.注意点
* 由于闭包会使得函数中的变量被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法就是在退出函数之前，将不使用的局部变量全部删除
* 闭包会在父函数外部，改变父函数内部变量的值。所以你把父函数当作对象使用，把闭包当作它的公用方法，把内部变量当作它的私有属性，这时一定要小心，不能随意改变父函数内部变量的值。

### 8.面试题
```javascript
function fun(n,o){
	console.log('n:'+n+' , o:'+o);
	return {
		fun: function(m){
			return fun(m,n);
		}
	};
}

var a = fun(0);  // n:0 , o:undefined
/*
	a = {
		fun: function(m){
			return fun(m,n);
		}
	}
*/
a.fun(1);
/*
	n = 0;
	m = 1;
	=> n:1 , o:0
*/

a.fun(2);        // => n:2 , o:0
a.fun(3);        // => n:3 , o:0

//				m=1=n		  m=3=n	
//				n=0=o		  n=2=o
var b = fun(0).fun(1).fun(2).fun(3);
//		n=0     		m=2=n
//		o=undefined		n=1=o

var c = fun(0).fun(1);  // 同上
// c.fun(2);        // m=2=n , n=1=o
// c.fun(3);        // m=3=n , n=1=o
```