---
title: 前端路由
date: 2019-02-22 17:51:50
tags: 路由
summary:
---
随着前端单页面应用的兴起，所有的前端框架都支持前端路由。在 HTML5 的 history API 出现之前，前端的路由都是通过 `hash` 来实现的，hash 能兼容低版本的浏览器
### hash
web服务不会解析hash，# 后的内容会被自动忽略，但是 JavaScript 是可以通过 window.location.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理<br />hash值的改变，都会在浏览器的访问历史中增加一个记录。因此我们能通过浏览器的回退、前进按钮控制hash的切换<br />我们可以使用hashchange事件来监听hash的变化

HTML5 history新增了两个API:`history.pushState`和`history.replaceState`<br />pushState新增一个历史记录，而replaceState是直接替换掉当前的历史记录<br />两个API都会操作浏览器的历史记录，而不会引起页面的刷新
```
window.history.pushState(null, null, "/about");
```

### History
基于Hash的路由实现，兼容性更好；而基于History API的路由，则更正式，更美观，可以设置与当前URL同源的任意URL，路径更直观。此外，基于Hash的路由不需要对服务器做改动，基于History API的路由需要对服务器做一些改造，需要对不同的路由进行相应的设置才行

### 实现路由
在React中封装一个路由组件<br />指明路由的模式为`hash`或者`history`
```html
<Switch hash>
  <Router to='/'>首页</Router>
  <Router to='/about'>关于</Router>
  <Router to='/mine'>我的</Router>
</Switch>
```

hash路由格式为
```
http://localhost:1234/#/
http://localhost:1234/#/about
```
history路由格式为
```
http://localhost:1234/
http://localhost:1234/about
```

#### 处理路由
```jsx
render() {
	const { children } = this.props;
	const { model, pathname, hash } = this.state;
	return (
		<div>
			{
				children.map((item, index)=>{
          // hash模式下拼装路由链接
					const to = (model==='hash'?'/#': '') + item.props.to;
					return (
						<Router 
							hash={hash} 
							pathname={pathname} 
							model={model} 
							to={to}
							key={index} 
							switch={()=>this.switch()}
					>{item.props.children}</Router>
					)
				})
			}
		</div>
	)
}
```

#### 路由跳转处理
* 添加激活路由className
* 处理a链接
```jsx
render() {
	const { children, to, hash, pathname } = this.props;
	return (
		<a 
			onClick={this.aClick.bind(this,to)}
			href={to}
			className={cx(
				'lc-router',
				{'lc-router-active': ( hash != '' ? hash : pathname ) === to}
			)}
		>{children}</a>
	)
}
```

#### aClick函数
```javascript
aClick(to,e) {
  	// 阻止默认事件
		e.preventDefault();
		this.pushState(to);
}
```

#### pushState函数
hash模式直接使用`window.location.href`跳转<br />history模式则使用`pushState`函数操作
```javascript
pushState (page) {
	const { hash } = this.props;
	if(hash != ''){
		window.location.href = page;
	}else{
		window.history.pushState(null, null, page);
	}
	this.props.switch();
}
```