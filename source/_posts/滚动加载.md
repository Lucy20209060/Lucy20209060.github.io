---
title: 滚动加载
date: 2019-03-19 15:27:25
tags: 滚动加载
summary:
---
该滚动加载适用于手机端和PC端
<a name="b6724cff"></a>
### 原理
监听容器滚动条，滚动到底部触发函数，请在该函数中加载数据，当容器内的数据不再变化时，说明没有更多数据，即停止加载
<a name="0d2f7312"></a>
### 使用该组件
必须设置组件的高度，组件没有高度则无法滚动<br />`loading`函数，滚动条滚动到底部后加载，该函数会被触发，在该函数中获取数据，并更新`dataSource`
```jsx
import React from 'react';
import './index.css';
import ScrollLoading from './components/ScrollLoading'

export default class Page extends React.Component{

	constructor(props) {
	    super(props);
	    this.state = {
	    	dataSource: [1,2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
		}
	}
  
	componentDidMount() {}
  
	render(){ 
		const { style } = this.props;
		const { dataSource } = this.state;
		return (
		  	<div className="scrollLoading-page">
                <ScrollLoading 
                    style={{height: '100%'}} 
                    loading={this.getData.bind(this)}
                >
                    {
                        dataSource.map((item, index)=>{
                            return <div style={{textAlign: 'center'}} key={index}>{item}</div>
                        })
                    }
                </ScrollLoading>
		  	</div>
		) 
	}
    // 请求数据
    getData() {
        const { dataSource } = this.state;
        const end = dataSource[dataSource.length -1];
        // 模拟数据请求
        if(this.state.dataSource.length <= 40){
            this.setState({
                dataSource: this.state.dataSource.concat([...this.range(end + 1, end+6)])
            })
        }else{
            this.setState({
                dataSource: this.state.dataSource
            })
        }
    }

    * range(start = 0, end = 0, step = 1) {
        if (start > end) {
            [start, end] = [end, start]
        }
        for (let i of Array((end - start) / step).keys()) {
            yield i * step + start
        }
    }
}
```
<a name="684734ea"></a>
### 组件源码
```jsx
import React from 'react';
import './ScrollLoading.css';
import {debounce} from './func'

export default class ScrollLoading extends React.Component{

	constructor(props) {
	    super(props);
	    this.state = {
            loading_animation_show: true,
            children_State: []
		}
    }

    componentDidMount() {
        const el = document.getElementById('scroll-loading');
        const _this = this;
        const { children } = this.props;
        const { children_State } = this.state;
        el.onscroll= function(){
            const scrollTop = el.scrollTop,
                offsetHeight = el.offsetHeight, 
                scrollHeight = el.scrollHeight;
          	// 滚动到底部
            if(scrollHeight === (scrollTop + offsetHeight) ){
              	// 函数防抖
                debounce(()=>{
                  	// 触发loading函数 请求数据
                    _this.props.loading();
                }, 800)
            }
        }
    }

    componentWillReceiveProps(nextProps) {
      	// 接收更新的数据列表
        const { children_State } = this.state;
        const { children } = nextProps;

        this.setState({
            children_State: children
        },()=>{
          	// 没有更多数据了 显示 无更多数据~
            if(children_State.length === nextProps.children.length){
                this.setState({
                    loading_animation_show: false
                })
            } 
        })
    }
	render(){ 
        const { style, children } = this.props;
        const { loading_animation_show } = this.state;
		return (
		  	<div id="scroll-loading" style={{height: '100%', overflow: 'auto', ...style}}>
                <div className="scroll-content">{children}</div>
                <div className='loading-animation box'>
                    {
                        loading_animation_show
                        ? <div className="loader"></div>
                        : <p>无更多数据~</p>
                    }
                </div>  
		  	</div>
		) 
	}
}
```
<a name="7e8b2fa2"></a>
### 效果
滚动加载<br />
<img width="300px" src="https://cdn.nlark.com/yuque/0/2019/jpeg/115449/1552980441989-ca8c7fc4-2765-431b-ad8c-12c30ccbe11d.jpeg" />
<br />没有更多数据<br />
<img width="300px" src="https://cdn.nlark.com/yuque/0/2019/jpeg/115449/1552980461022-e64068e4-62e2-4c26-956e-bc0d24c16062.jpeg" />