<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Lucy"><title>使用travis-ci自动部署hexo · 长剑腥腥挂壁</title><meta name="description" content="hexoHexo是一款基于Node.js的静态博客框架今天我们并不是讨论如何使用hexo搭建自己的博客，如果你需要，可以查看我与之相关的博客
hexo发布流程12345hexo clean // 清除上一次生成的静态页面hexo generate 或 hexo g // 生成最新的静态页面hexo "><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/logo-2.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo-2.png" style="width:127px;"><h3 title><a href="/">长剑腥腥挂壁</a></h3></div></div><ul class="social-links"></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/logo-2.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>使用travis-ci自动部署hexo</a></h3></div><div class="post-content"><p><a name="hexo"></a></p>
<h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h3><p>Hexo是一款基于Node.js的静态博客框架<br>今天我们并不是讨论如何使用hexo搭建自己的博客，如果你需要，可以查看我与之相关的<a href="https://lucy20209060.github.io/2017/09/03/hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" target="_blank" rel="noopener">博客</a><br><a name="a34c64fd"></a></p>
<h4 id="hexo发布流程"><a href="#hexo发布流程" class="headerlink" title="hexo发布流程"></a>hexo发布流程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo clean // 清除上一次生成的静态页面</span><br><span class="line"></span><br><span class="line">hexo generate 或 hexo g // 生成最新的静态页面</span><br><span class="line"></span><br><span class="line">hexo deploy 或 hexo d // 将最新的静态页面发布到gitHub</span><br></pre></td></tr></table></figure>
<p>因为在项目中已经你配置了自己的github帐号，所以发布之后，内容会提交到你的github，在相关仓库的master分支上，一会你的博客上就能看到最新的内容了<br><a name="5dc99f6e"></a></p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>自己的电脑上是项目文件，提交的是生成后的静态文件<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551433352809-2046baf0-c61b-4753-a362-28ac0f21a991.png#align=left&amp;display=inline&amp;height=1178&amp;name=WX20190301-174206%402x.png&amp;originHeight=1178&amp;originWidth=518&amp;size=88665&amp;status=done&amp;width=518" alt="WX20190301-174206@2x.png"><br>这是整个本地开发时的项目文件，红框中的是被提交的静态文件，两份代码并不完全一样<br>提交的是<code>public</code>文件中的内容，但项目文件没有备份，如果不小心被删除了，或者出了什么问题，那就傻逼了<br>如果我经常用两台电脑，那么我怎么书写并发布自己的博客内容</p>
<p><a name="de842a6c"></a></p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>所以，我有一个需求<br>在博客的仓库<code>dev</code>分支开发项目，然后把<code>public</code>文件中的静态文件发布到<code>master</code>分支<br>如果真的可以这样，那就解决所有的问题<br>确实可以<br><a name="travis-ci"></a></p>
<h3 id="travis-ci"><a href="#travis-ci" class="headerlink" title="travis-ci"></a>travis-ci</h3><p>用于持续集成完成自动化测试部署的开源项目<br><a name="fe0e8bf7"></a></p>
<h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><p>官网<a href="https://travis-ci.org/" target="_blank" rel="noopener">https://travis-ci.org/</a>，使用github帐号登录<br><br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551434004603-87d33c2a-3bda-4de5-a1d4-ec29df3e386b.png#align=left&amp;display=inline&amp;height=310&amp;name=20190301175309.png&amp;originHeight=858&amp;originWidth=2062&amp;size=175245&amp;status=done&amp;width=746" alt="20190301175309.png"></p>
<p><a name="4e72650f"></a></p>
<h4 id="选择博客仓库"><a href="#选择博客仓库" class="headerlink" title="选择博客仓库"></a>选择博客仓库</h4><p>点击小加号进去选择，当然图中我已经选好了<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551434228181-38016d69-af61-4e6e-a852-2bdeca10a80e.png#align=left&amp;display=inline&amp;height=348&amp;name=20190301175629.png&amp;originHeight=966&amp;originWidth=2072&amp;size=273594&amp;status=done&amp;width=746" alt="20190301175629.png"><br>进去后选择自己的博客仓库，打开仓库后面的开关即可<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551434465186-bcf480f5-b413-4cd5-a694-2d813139ca41.png#align=left&amp;display=inline&amp;height=50&amp;name=20190301180051.png&amp;originHeight=88&amp;originWidth=1322&amp;size=27690&amp;status=done&amp;width=746" alt="20190301180051.png"><br>这个<code>settings</code>稍后再说</p>
<p><a name="c9f2d224"></a></p>
<h4 id="github上Access-Token"><a href="#github上Access-Token" class="headerlink" title="github上Access Token"></a>github上Access Token</h4><p>由于需要操作github的api接口，所以我们需要授权，获取<code>Token</code><br>直接进入该链接<a href="https://github.com/settings/tokens" target="_blank" rel="noopener">https://github.com/settings/tokens</a><br>点击<code>Personal access token</code><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551434918078-c531b9c9-4ae4-4a7a-afdd-309e9d9ed141.png#align=left&amp;display=inline&amp;height=280&amp;name=20190301180807.png&amp;originHeight=762&amp;originWidth=2032&amp;size=217395&amp;status=done&amp;width=746" alt="20190301180807.png"><br>点击<code>Generate new token</code><br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551434959552-d796f3cb-1530-49ee-b5b6-dc8a81f28e16.png#align=left&amp;display=inline&amp;height=491&amp;name=20190301180628.png&amp;originHeight=1320&amp;originWidth=2006&amp;size=314336&amp;status=done&amp;width=746" alt="20190301180628.png"></p>
<p>添加该token的描述并且选择权限<br>生成之后一定要保存好，因为只会出现一次，刷新页面就看不到了</p>
<p><a name="53c9a42c"></a></p>
<h4 id="配置token字段"><a href="#配置token字段" class="headerlink" title="配置token字段"></a>配置token字段</h4><p>进入上面说的<code>settings</code><br>将上一步获取到的token添加到配置中，这将是后面说到的文件的全局变量<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551435364600-be7a8b66-12e4-434f-b321-d1308d3ff968.png#align=left&amp;display=inline&amp;height=61&amp;name=20190301181457.png&amp;originHeight=128&amp;originWidth=1568&amp;size=26021&amp;status=done&amp;width=746" alt="20190301181457.png"><br>变量名自己随便取个有意义的即可</p>
<p><a name="6df5ad43"></a></p>
<h4 id="博客项目中添加配置文件-travis-yml"><a href="#博客项目中添加配置文件-travis-yml" class="headerlink" title="博客项目中添加配置文件.travis.yml"></a>博客项目中添加配置文件.travis.yml</h4><p>在项目文件根目录添加<code>.travis.yml</code>文件，内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">language: node_js # 声明环境为node</span><br><span class="line">node_js: </span><br><span class="line">  - &quot;8&quot;</span><br><span class="line"></span><br><span class="line"># Travis-CI Caching</span><br><span class="line">cache:</span><br><span class="line">  directories:</span><br><span class="line">    - node_modules # 缓存node_modules文件夹</span><br><span class="line"></span><br><span class="line"># S: Build Lifecycle</span><br><span class="line">install:</span><br><span class="line">  - npm install # 下载依赖</span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">  - hexo c</span><br><span class="line">  - hexo g</span><br><span class="line"></span><br><span class="line">after_script: # 推送到github的部分</span><br><span class="line">  - cd ./public</span><br><span class="line">  - git init</span><br><span class="line">  - git config user.name &quot;github对应的帐号&quot;</span><br><span class="line">  - git config user.email &quot;github对应的邮箱&quot;</span><br><span class="line">  - git add .</span><br><span class="line">  - git commit -m &quot;Update docs&quot;</span><br><span class="line">  - git push --force --quiet &quot;https://$&#123;GIT_REPO_TOKEN&#125;@$&#123;GH_REF&#125;&quot; master:master # 通过之前存在Travis-CI里的token以及github仓库的地址推送到相应的master分支</span><br><span class="line"># E: Build LifeCycle</span><br><span class="line"></span><br><span class="line">branches:</span><br><span class="line">  only:</span><br><span class="line">    - dev # 只对dev分支构建</span><br><span class="line"></span><br><span class="line">env: # 环境变量</span><br><span class="line"> global:</span><br><span class="line">   - GH_REF: github.com/Lucy20209060/Lucy20209060.github.io # 我的仓库地址</span><br></pre></td></tr></table></figure></p>
<p><code>GIT_REPO_TOKEN</code>就是上面说到的token<br><code>GH_REF</code>是下面的环境变量，就是你的仓库地址</p>
<p><a name="73378aea"></a></p>
<h3 id="提交代码"><a href="#提交代码" class="headerlink" title="提交代码"></a>提交代码</h3><p>在<code>dev</code>分支开发完成后，提交代码至<code>dev</code>分支<br>我们便可以在官网看到构建过程<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551437095374-4b29b0d8-8e96-4391-9520-2e3b3e833bda.png#align=left&amp;display=inline&amp;height=396&amp;name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-03-01%20%E4%B8%8B%E5%8D%886.44.43.png&amp;originHeight=1520&amp;originWidth=2866&amp;size=381235&amp;status=done&amp;width=746" alt="屏幕快照 2019-03-01 下午6.44.43.png"></p>
<p>最后达到了我们要的结果<br>dev上是项目代码<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551437248027-56b26811-f2d1-4efb-909c-a656320717c8.png#align=left&amp;display=inline&amp;height=300&amp;name=20190301184658.png&amp;originHeight=808&amp;originWidth=2008&amp;size=253482&amp;status=done&amp;width=746" alt="20190301184658.png"><br>master上是生成后的静态文件<br><img src="https://cdn.nlark.com/yuque/0/2019/png/115449/1551437301803-1277ca65-f8d9-4483-ac5a-810301f6469f.png#align=left&amp;display=inline&amp;height=411&amp;name=20190301184559.png&amp;originHeight=1104&amp;originWidth=2006&amp;size=279233&amp;status=done&amp;width=746" alt="20190301184559.png"></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-03-05</span><i class="fa fa-tag"></i><a class="tag" href="/tags/hexo/" title="hexo">hexo </a><a class="tag" href="/tags/travis/" title="travis">travis </a><a class="tag" href="/tags/travis-ci/" title="travis-ci">travis-ci </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/03/06/express设置允许跨域/" title="express设置允许跨域">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/03/04/MySQL常用语法/" title="MySQL常用语法">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>