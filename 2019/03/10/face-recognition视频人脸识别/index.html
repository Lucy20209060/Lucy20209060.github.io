<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Lucy"><title>face_recognition视频人脸识别 · 长剑腥腥挂壁</title><meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#!/usr/bin/env pyth"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/logo-2.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo-2.png" style="width:127px;"><h3 title><a href="/">长剑腥腥挂壁</a></h3></div></div><ul class="social-links"></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/logo-2.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>face_recognition视频人脸识别</a></h3></div><div class="post-content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> face_recognition</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">video_capture = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地图像</span></span><br><span class="line">lc_image = face_recognition.load_image_file(<span class="string">"./img/test04.jpg"</span>)</span><br><span class="line">lc_face_encoding = face_recognition.face_encodings(lc_image)</span><br><span class="line"></span><br><span class="line">face_locations = []</span><br><span class="line">face_encodings = []</span><br><span class="line">face_names = []</span><br><span class="line">process_this_frame = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 读取摄像头画面</span></span><br><span class="line">    ret, frame = video_capture.read()</span><br><span class="line">    <span class="comment"># 改变摄像头图像的大小，图像小，所做的计算就少</span></span><br><span class="line">    small_frame = cv2.resize(frame, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.25</span>, fy=<span class="number">0.25</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># opencv的图像是BGR格式的，而我们需要是的RGB格式的，因此需要进行一个转换。</span></span><br><span class="line">    rgb_small_frame = small_frame[:, :, ::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Only process every other frame of video to save time</span></span><br><span class="line">    <span class="comment"># if process_this_frame:</span></span><br><span class="line">        <span class="comment"># 根据encoding来判断是不是同一个人，是就输出true，不是为flase</span></span><br><span class="line">    face_locations = face_recognition.face_locations(rgb_small_frame)</span><br><span class="line">    face_encodings = face_recognition.face_encodings(rgb_small_frame, face_locations)</span><br><span class="line">    <span class="comment"># print(type(face_encodings))</span></span><br><span class="line"></span><br><span class="line">    l = len(face_encodings)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, l):</span><br><span class="line">        match = face_recognition.compare_faces(lc_face_encoding, face_encodings[i])</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        top = face_locations[i][<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">        right = face_locations[i][<span class="number">1</span>]*<span class="number">4</span></span><br><span class="line">        bottom = face_locations[i][<span class="number">2</span>]*<span class="number">4</span></span><br><span class="line">        left = face_locations[i][<span class="number">3</span>]*<span class="number">4</span></span><br><span class="line">        font = cv2.FONT_HERSHEY_DUPLEX</span><br><span class="line">        match = face_recognition.compare_faces(lc_face_encoding, face_encodings[i])</span><br><span class="line">        name = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> match[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># 矩形框</span></span><br><span class="line">            cv2.rectangle(frame, (left, top), (right, bottom), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">            <span class="comment">#加上标签</span></span><br><span class="line">            cv2.rectangle(frame, (left, bottom - <span class="number">35</span>), (right, bottom), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), cv2.FILLED)</span><br><span class="line">            name = <span class="string">'luchao'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 矩形框</span></span><br><span class="line">            cv2.rectangle(frame, (left, top), (right, bottom), (<span class="number">50</span>,<span class="number">205</span>,<span class="number">50</span>), <span class="number">2</span>)</span><br><span class="line">            <span class="comment">#加上标签</span></span><br><span class="line">            cv2.rectangle(frame, (left, bottom - <span class="number">35</span>), (right, bottom), (<span class="number">50</span>,<span class="number">205</span>,<span class="number">50</span>), cv2.FILLED)</span><br><span class="line">            name = <span class="string">'Unknow'</span></span><br><span class="line">        cv2.putText(frame, name, (left + <span class="number">6</span>, bottom - <span class="number">6</span>), font, <span class="number">1.0</span>, (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># print(i,name,match[0])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Display</span></span><br><span class="line">    cv2.imshow(<span class="string">'Video'</span>, frame)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按Q退出</span></span><br><span class="line">    <span class="keyword">if</span> cv2.waitKey(<span class="number">1</span>) &amp; <span class="number">0xFF</span> == ord(<span class="string">'q'</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">video_capture.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-03-10</span><i class="fa fa-tag"></i><a class="tag" href="/tags/face-recognition/" title="face_recognition">face_recognition </a><a class="tag" href="/tags/人脸识别/" title="人脸识别">人脸识别 </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/03/11/TypeScript—基础类型/" title="TypeScript—基础类型">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/03/09/face-recognition图片人脸识别/" title="face_recognition图片人脸识别">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>