<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Lucy"><title>前端路由 · 长剑腥腥挂壁</title><meta name="description" content="随着前端单页面应用的兴起，所有的前端框架都支持前端路由。在 HTML5 的 history API 出现之前，前端的路由都是通过 hash 来实现的，hash 能兼容低版本的浏览器
hashweb服务不会解析hash，# 后的内容会被自动忽略，但是 JavaScript 是可以通过 window.l"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/logo-2.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo-2.png" style="width:127px;"><h3 title><a href="/">长剑腥腥挂壁</a></h3></div></div><ul class="social-links"></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/logo-2.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>前端路由</a></h3></div><div class="post-content"><p>随着前端单页面应用的兴起，所有的前端框架都支持前端路由。在 HTML5 的 history API 出现之前，前端的路由都是通过 <code>hash</code> 来实现的，hash 能兼容低版本的浏览器</p>
<h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>web服务不会解析hash，# 后的内容会被自动忽略，但是 JavaScript 是可以通过 window.location.hash 读取到的，读取到路径加以解析之后就可以响应不同路径的逻辑处理<br>hash值的改变，都会在浏览器的访问历史中增加一个记录。因此我们能通过浏览器的回退、前进按钮控制hash的切换<br>我们可以使用hashchange事件来监听hash的变化</p>
<p>HTML5 history新增了两个API:<code>history.pushState</code>和<code>history.replaceState</code><br>pushState新增一个历史记录，而replaceState是直接替换掉当前的历史记录<br>两个API都会操作浏览器的历史记录，而不会引起页面的刷新<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.history.pushState(null, null, &quot;/about&quot;);</span><br></pre></td></tr></table></figure></p>
<h3 id="History"><a href="#History" class="headerlink" title="History"></a>History</h3><p>基于Hash的路由实现，兼容性更好；而基于History API的路由，则更正式，更美观，可以设置与当前URL同源的任意URL，路径更直观。此外，基于Hash的路由不需要对服务器做改动，基于History API的路由需要对服务器做一些改造，需要对不同的路由进行相应的设置才行</p>
<h3 id="实现路由"><a href="#实现路由" class="headerlink" title="实现路由"></a>实现路由</h3><p>在React中封装一个路由组件<br>指明路由的模式为<code>hash</code>或者<code>history</code><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Switch</span> <span class="attr">hash</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Router</span> <span class="attr">to</span>=<span class="string">'/'</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Router</span> <span class="attr">to</span>=<span class="string">'/about'</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Router</span> <span class="attr">to</span>=<span class="string">'/mine'</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>hash路由格式为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:1234/#/</span><br><span class="line">http://localhost:1234/#/about</span><br></pre></td></tr></table></figure></p>
<p>history路由格式为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:1234/</span><br><span class="line">http://localhost:1234/about</span><br></pre></td></tr></table></figure></p>
<h4 id="处理路由"><a href="#处理路由" class="headerlink" title="处理路由"></a>处理路由</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; children &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">	<span class="keyword">const</span> &#123; model, pathname, hash &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			&#123;</span><br><span class="line">				children.map(<span class="function">(<span class="params">item, index</span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="comment">// hash模式下拼装路由链接</span></span><br><span class="line">					<span class="keyword">const</span> to = (model===<span class="string">'hash'</span>?<span class="string">'/#'</span>: <span class="string">''</span>) + item.props.to;</span><br><span class="line">					<span class="keyword">return</span> (</span><br><span class="line">						&lt;Router </span><br><span class="line">							hash=&#123;hash&#125; </span><br><span class="line">							pathname=&#123;pathname&#125; </span><br><span class="line">							model=&#123;model&#125; </span><br><span class="line">							to=&#123;to&#125;</span><br><span class="line">							key=&#123;index&#125; </span><br><span class="line">							<span class="keyword">switch</span>=&#123;()=&gt;<span class="keyword">this</span>.switch()&#125;</span><br><span class="line">					&gt;&#123;item.props.children&#125;&lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">					)</span></span><br><span class="line"><span class="regexp">				&#125;)</span></span><br><span class="line"><span class="regexp">			&#125;</span></span><br><span class="line"><span class="regexp">		&lt;/</span>div&gt;</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="路由跳转处理"><a href="#路由跳转处理" class="headerlink" title="路由跳转处理"></a>路由跳转处理</h4><ul>
<li>添加激活路由className</li>
<li>处理a链接<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; children, to, hash, pathname &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		&lt;a </span><br><span class="line">			onClick=&#123;<span class="keyword">this</span>.aClick.bind(<span class="keyword">this</span>,to)&#125;</span><br><span class="line">			href=&#123;to&#125;</span><br><span class="line">			className=&#123;cx(</span><br><span class="line">				<span class="string">'lc-router'</span>,</span><br><span class="line">				&#123;<span class="string">'lc-router-active'</span>: ( hash != <span class="string">''</span> ? hash : pathname ) === to&#125;</span><br><span class="line">			)&#125;</span><br><span class="line">		&gt;&#123;children&#125;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">	)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="aClick函数"><a href="#aClick函数" class="headerlink" title="aClick函数"></a>aClick函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aClick(to,e) &#123;</span><br><span class="line">  	<span class="comment">// 阻止默认事件</span></span><br><span class="line">		e.preventDefault();</span><br><span class="line">		<span class="keyword">this</span>.pushState(to);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="pushState函数"><a href="#pushState函数" class="headerlink" title="pushState函数"></a>pushState函数</h4><p>hash模式直接使用<code>window.location.href</code>跳转<br>history模式则使用<code>pushState</code>函数操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pushState (page) &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; hash &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">	<span class="keyword">if</span>(hash != <span class="string">''</span>)&#123;</span><br><span class="line">		<span class="built_in">window</span>.location.href = page;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">window</span>.history.pushState(<span class="literal">null</span>, <span class="literal">null</span>, page);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">this</span>.props.switch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-02-22</span><i class="fa fa-tag"></i><a class="tag" href="/tags/路由/" title="路由">路由 </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/02/25/开发一个类似于vue-cli的前端脚手架工具/" title="开发一个类似于vue-cli的前端脚手架工具">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/02/21/js的内存空间/" title="js的内存空间">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>