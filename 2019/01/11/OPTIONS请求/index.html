<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Lucy"><title>OPTIONS请求 · 长剑腥腥挂壁</title><meta name="description" content="在项目中ajax发起get请求去请求mock数据，发现接口发出去了两次请求，一直在找我代码哪里写的有问题触发了两次请求
点开查看发现第一个请求方式为OPTIONS，并且没有返回任何数据
第二个为GET，这才返回数据
我就很好奇OPTIONS，因为一直都没有见过这种请求方式
查找原因是浏览器对简单跨域"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/logo-2.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo-2.png" style="width:127px;"><h3 title><a href="/">长剑腥腥挂壁</a></h3></div></div><ul class="social-links"></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/logo-2.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>OPTIONS请求</a></h3></div><div class="post-content"><p>在项目中ajax发起get请求去请求mock数据，发现接口发出去了两次请求，一直在找我代码哪里写的有问题触发了两次请求<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/115449/1547046162927-feac96f1-eb1c-4834-86d5-fce8bbe38ad5.jpeg#align=left&amp;display=inline&amp;height=115&amp;linkTarget=_blank&amp;name=15_32_35__01_09_2019.jpg&amp;originHeight=115&amp;originWidth=241&amp;size=15604&amp;width=241" alt="15_32_35__01_09_2019.jpg"></p>
<p>点开查看发现第一个请求方式为<code>OPTIONS</code>，并且没有返回任何数据<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/115449/1547046448361-55460b9e-545b-4a51-8af8-a8eaffcf61bb.jpeg#align=left&amp;display=inline&amp;height=158&amp;linkTarget=_blank&amp;name=23_06_24__01_09_2019.jpg&amp;originHeight=158&amp;originWidth=610&amp;size=69332&amp;width=610" alt="23_06_24__01_09_2019.jpg"></p>
<p>第二个为<code>GET</code>，这才返回数据<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/115449/1547046150491-ccd4fdfe-f956-43cc-b218-a1dc41a927c4.jpeg#align=left&amp;display=inline&amp;height=162&amp;linkTarget=_blank&amp;name=15_34_05__01_09_2019.jpg&amp;originHeight=162&amp;originWidth=613&amp;size=53568&amp;width=613" alt="15_34_05__01_09_2019.jpg"><br></p>
<p>我就很好奇<code>OPTIONS</code>，因为一直都没有见过这种请求方式</p>
<p>查找原因是浏览器对简单跨域请求和复杂跨域请求的处理区别<br>XMLHttpRequest会遵守同源策略(same-origin policy). 也即脚本只能访问相同协议/相同主机名/相同端口的资源, 如果要突破这个限制, 那就是所谓的跨域, 此时需要遵守CORS(Cross-Origin Resource Sharing)机制<br>那么, 允许跨域, 不就是服务端设置Access-Control-Allow-Origin: *就可以了吗? 普通的请求才是这样子的, 除此之外, 还一种叫请求叫preflighted request<br>preflighted request在发送真正的请求前, 会先发送一个方法为OPTIONS的预请求(preflight request), 用于试探服务端是否能接受真正的请求，如果options获得的回应是拒绝性质的，比如404\403\500等http状态，就会停止post、put等请求的发出</p>
<p>那么, 什么情况下请求会变成preflighted request呢?<br>1、请求方法不是GET/HEAD/POST<br>2、POST请求的Content-Type并非application/x-www-form-urlencoded, multipart/form-data, 或text/plain<br>3、请求设置了自定义的header字段</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-01-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/OPTIONS/" title="OPTIONS">OPTIONS </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/01/12/Python—操作列表/" title="Python—操作列表">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/01/10/b和strong的区别/" title="&lt;b&gt;和&lt;strong&gt;的区别">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>